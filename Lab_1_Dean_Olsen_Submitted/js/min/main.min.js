$(document).ready(function(){function t(t){var e=[],n=1/0,o=-1/0;for(var a in t.features){var r=t.features[a].properties;for(var i in r)"id"!=i&&"code"!=i&&"airport_name"!=i&&"city_name"!=i&&"latitude"!=i&&"longitude"!=i&&(-1===$.inArray(i,e)&&e.push(i),r[i]<n&&(n=r[i]),r[i]>o&&(o=r[i]))}return{timestamps:e,min:n,max:o}}function e(t,e){l=L.geoJson(e,{pointToLayer:function(t,e){return L.circleMarker(e,{fillColor:"#708598",color:"#537898",weight:2,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"yellow"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#537898"})}})}}).addTo(map),n(t[0])}function n(t){l.eachLayer(function(e){var n=e.feature.properties,r=a(n[t]),i=o(String(n[t]))+" Aircraft Movements  at "+n.airport_name+" in "+t;e.setRadius(r),e.bindPopup(i,{offset:new L.Point(0,-r)})})}function o(t){var e=t;if(parseFloat(t)){t=new String(t);var n=t.split(".");n[0]=n[0].split("").reverse().join("").replace(/(\d{3})(?!$)/g,"$1,").split("").reverse().join(""),e=n.join(".")}return e}function a(t){var e=8;return area=t/1e4*e,3*Math.sqrt(area/Math.PI)}function r(t,e){function n(t){return 1e5*Math.round(t/1e5)}var o=L.control({position:"bottomright"});o.onAdd=function(){var o,r,i,p=L.DomUtil.create("div","legend"),l=L.DomUtil.create("div","symbolsContainer"),s=[n(t),n((e+t)/2),n(e)],u=0;L.DomEvent.addListener(p,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(p).append("<h2 id='legendTitle'>Aircraft Movements</h2>");for(var d=0;d<=s.length-1;d++)o=L.DomUtil.create("div","legendCircle"),r=a(s[d]),i=-r-u-3.9,$(o).attr("style","width: "+2*r+"px;  height: "+2*r+"px; margin-left: "+i+"px"),$(o).append("<span class='legendValue'>"+s[d]+"<span>"),$(l).append(o),u=r;return $(p).append(l),p},o.addTo(map)}function i(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(e,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(e).attr({type:"range",max:t.length-1,min:0,step:1,value:0}).on("input",function(){n(t[$(this).val()]),$(".temporal-legend").text(t[this.value])}),e},e.addTo(map),p(t[0])}function p(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return $(e).text(t),e},e.addTo(map)}var l;map=L.map("map",{center:[37.8,-96],zoom:4,minZoom:4}),L.tileLayer("http://{s}.acetate.geoiq.com/tiles/acetate/{z}/{x}/{y}.png",{attribution:"Acetate tileset from GeoIQ"}).addTo(map),$.getJSON("data/airport_data.json").done(function(n){var o=t(n);e(o.timestamps,n),r(o.min,o.max),i(o.timestamps)}).fail(function(){alert("There has been a problem loading the data.")})});