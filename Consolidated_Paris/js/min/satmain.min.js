function SizeMe(e){$("body").height($(window).outerHeight()-40),$("body").width($(window).outerWidth());var t=($("body").width(),$("body").height(),40),o=161;$("#map").height($("body").height()-$("#map").offset().top),$("#menu").height($("#map").height()-t),$("#SubjectiveMarkers").height($("#menu").height()-o),e.invalidateSize()}$(document).ready(function(){function e(e,o,i){var a=[];for(var r in e)a.push('<input type="checkbox" name="SMFilter" value="'+n(e[r])+'">'+e[r]+"&nbsp;&#40;"+o.SMCount[e[r]]+"&#41;</input>");a.sort(),$("#SubjectiveMarkers").html(a.join("<br />")),$("#SubjectiveMarkers input").on("click",function(){t(o,i)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),t(o,i)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),t(o,i)}),$("#resetMapBtn").click(function(){p.setView([48.874,2.358],15)})}function t(e,t){d=[],$("input:checkbox[name=SMFilter]:checked").each(function(){d.push(n($(this).val()))}),$("input:checkbox[name=SMFilter]").not(":checked").each(function(){$("."+n($(this).val())).remove()}),$("#checkedNum").html(d.length+"<i>&nbsp;&nbsp;SMs selected</i> <br>(&nbsp;&nbsp;)<i>&nbsp;&nbsp;=&nbsp;&nbsp;times cited in text</i>"),i(e,t)}function o(e){var t=[],o=[],n=[],i=[],a={};for(var r in e.features){var c=e.features[r].properties;void 0===o[c.Page]&&(t.push(c.Page),o[c.Page]=1),void 0===i[c.SM]&&(n.push(c.SM),i[c.SM]=1),void 0===a[c.SM]?a[c.SM]=1:a[c.SM]+=1}return{SMs:n,pages:t.sort(function(e,t){return e-t}),SMCount:a}}function n(e){return e.replace(/\s/g,"").replace(/[^a-zA-Z 0-9]+/g,"").toLowerCase()}function i(e,t,o,i,c){p.hasLayer(s)&&p.removeLayer(s),c&&$("#dvAllMyZooms").empty();var l=[];s=L.geoJson(t,{filter:function(e){return o?e.properties.Page==o?!0:!1:-1!=$.inArray(n(e.properties.SM),d)?!0:!1},pointToLayer:function(e,t){l.push([t.lat,t.lng]);var o=L.circle(t,200,{fillColor:a(e.properties.SM),color:a(e.properties.SM),stroke:!1,weight:2,clickable:!0,fillOpacity:0,opacity:0}),i=p.latLngToContainerPoint(t);i.latlng=t;var r=n(e.properties.SM),c=function(e){var t="zoomlens"+u,o="olay"+u,n="zoommap"+u++;$("#dvAllMyZooms").append("<div id='"+t+"' class='zoomlens "+r+" overlay'><div id='"+o+"' class='overlay rotater'><div class='overlay rotater'><div id='"+n+"' class='zoommap overlay'></div></div></div><div id='border' class='overlay'></div></div>");var i=document.getElementById(t),a=L.mapbox.map(n,"deanolsen1.l6h0h2j6",{opacity:1,attributionControl:!1}).setView([48.874,2.358],15);p.dragging.disable(),p.touchZoom.disable(),p.doubleClickZoom.disable(),p.scrollWheelZoom.disable(),zoomIt=function(){a._loaded&&a.setZoom(p.getZoom(15))},updateLens=function(e){i.style.top=e.y+"px",i.style.left=e.x+"px",a.setView(e.latlng,p.getZoom(15),!0)},p.on("zoomend",function(){updateLens(e),zoomIt(e)}),p.on("dragend",function(){updateLens(e),zoomIt(e)}),updateLens(e),zoomIt(e)};return c(i),o}}).addTo(p),r()}function a(){return"#CC2B0A"}function r(){s.eachLayer(function(e){console.log(e)})}function c(e,t,o){var n=$("#mySlider");$(n).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}),$(n).css("width","500px"),$(n).on("input change",function(){$(".temporal-legend").text("on page "+this.value)}),$(n).on("change",function(){i(t,o,this.value,null,!0),$(".temporal-legend").text("on page "+this.value)}),l(e[0])}function l(e){var t=L.control({position:"bottomright"});t.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},t.addTo(p),$(".temporal-legend").text("on page "+e)}var s,u=0,d=[];L.mapbox.accessToken="pk.eyJ1IjoiZGVhbm9sc2VuMSIsImEiOiJ1dkxBdm9FIn0.kapau_lUukKIE93Y8I0A9g";var p=L.mapbox.map("map","deanolsen1.laf3g5ko",{zoomControl:!1,opacity:1,attributionControl:!1});p.setView([48.874,2.358],15),$(window).resize(function(){$("#sliderContainer").css("margin-right","0px"),$("#temporal-legend").css("margin-right","0px"),SizeMe(p)}),SizeMe(p),$.getJSON("data/Locationsfrench.geojson").done(function(n){var a=o(n);i(a,n),c(a.pages,a,n),e(a.SMs,a,n),t(a,n)}).fail(function(){alert("There has been a problem loading the data.")}),$(".buttonMin").click(function(){$(this).toggleClass("btn-plus"),$("div.scroll").slideToggle()})});