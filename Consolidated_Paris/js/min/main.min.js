function SizeMe(e){$("body").height($(window).outerHeight()-40),$("body").width($(window).outerWidth());var t=($("body").width(),$("body").height(),40),n=151,r=49,i=20;$("#map").height($("body").height()-$("#map").offset().top),$("#menu").height($("#map").height()-t),$("#vcr-controls").css("top",$("#map").offset().top+$("#map").height()-r-i+"px"),$("#SubjectiveMarkers").height($("#menu").height()-n),e.invalidateSize()}$(document).ready(function(){function e(e,r,i){var o=[];o.sort();for(var a in e)o.push('<input type="checkbox" name="SMFilter" value="'+t(e[a])+'">'+e[a]+" &nbsp;&#40;"+r.SMCount[e[a]]+"&#41;</input>");o.sort(),$("#SubjectiveMarkers").html(o.join("<br />")),$("#SubjectiveMarkers").on("click",function(){n(r,i),$(".pause").hide(),$(".play").show(),l(r,i)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),n(r,i),$(".pause").hide(),$(".play").show(),l(r,i)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),n(r,i)}),$("#resetMapBtn").click(function(){M.setView([48.874,2.358],15)})}function t(e){return e.replace(/\s/g,"").replace(/[^a-zA-Z 0-9]+/g,"").toLowerCase()}function n(e,n){S=[],$("input:checkbox[name=SMFilter]:checked").each(function(){S.push(t($(this).val()))}),$("#checkedNum").html(S.length+"<i>&nbsp;&nbsp;SMs selected</i> <br>(&nbsp;&nbsp;)<i>&nbsp;&nbsp;=&nbsp;&nbsp;times cited in text</i>"),i(e,n)}function r(e){var t=[],n=[],r=[],i=[],o={};for(var a in e.features){var c=e.features[a].properties;void 0===n[c.Page]&&(t.push(c.Page),n[c.Page]=1),void 0===i[c.SM]&&(r.push(c.SM),i[c.SM]=1),void 0===o[c.SM]?o[c.SM]=1:o[c.SM]+=1}return{SMs:r,pages:t.sort(function(e,t){return e-t}),SMCount:o}}function i(e,n,r){M.hasLayer(f)&&M.removeLayer(f),f=L.geoJson(n,{filter:function(e){return r?e.properties.Page==r?!0:!1:-1!==$.inArray(t(e.properties.SM),S)?!0:!1},pointToLayer:function(e,t){return L.circle(t,100,{fillColor:o(e.properties.SM),color:o(e.properties.SM),weight:3,fillOpacity:.4}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#000000"})}})}}).addTo(M),a()}function o(e){return"Objet d&#8217;art involontaire"===e?"rgb(166,206,227)":"Image acoustique"===e?"rgb(178,223,138)":"Ambiance"===e?"rgb(51,160,44)":"Annonce"===e?"rgb(251,154,153)":"Antiville"===e?"rgb(227,26,28)":"Apparition"===e?"rgb(253,191,111)":"Archive"===e?"rgb(255,127,0)":"Sacrifice de pi&#232;ce"===e?"rgb(166,206,227)":"Attraction"===e?"rgb(202,178,214)":"Branding"===e?"rgb(106,61,154)":"Cartographie"===e?"rgb(255,255,153)":"Aveu"===e?"rgb(177,89,40)":"Configuration"===e?"rgb(141,211,199)":"Site conflictuel"===e?"rgb(255,255,179)":"Contact"===e?"rgb(190,186,218)":"Danger"===e?"rgb(251,128,114)":"L&#8217;ignoriez-vous? "===e?"rgb(128,177,211)":"Vie future"===e?"rgb(253,180,98)":"Information implicite"===e?"rgb(179,222,105)":"Incident"===e?"rgb(252,205,229)":"Incursion dans le monde contrefactuel"===e?"rgb(217,217,217)":"Mobilier de norme"===e?"rgb(188,128,189)":"Intervention"===e?"rgb(204,235,197)":"Comparaison inter-zones"===e?"rgb(255,237,111)":"Intrusion"===e?"rgb(141,211,199)":"Figure locale"===e?"rgb(255,255,179)":"Esth&#233;tique Mat&#233;rielle"===e?"rgb(190,186,218)":"Image mentale"===e?"rgb(251,128,114)":"M&#233;thode"===e?"rgb(253,180,98)":"Zone negative"===e?"rgb(253,180,98)":"Numerophilie"===e?"rgb(179,222,105)":"Effet optique "===e?"rgb(252,205,229)":"Performance"===e?"rgb(217,217,217)":"Zone positive"===e?"rgb(188,128,189)":"Ville ant&#233;rieure"===e?"rgb(204,235,197)":"Vie ant&#233;rieure"===e?"rgb(255,237,111)":"Palmar&#232;s"===e?"rgb(141,211,199)":"Proc&#233;dure"===e?"rgb(255,255,179)":"Programme"===e?"rgb(190,186,218)":"Projet"===e?"rgb(251,128,114)":"Proposition"===e?"rgb(128,177,211)":"Ambiance raciale"===e?"rgb(253,180,98)":"Rebapt&#234;me"===e?"rgb(179,222,105)":"Acquisition recente"===e?"rgb(252,205,229)":"Reconversion"===e?"rgb(217,217,217)":"Scene"===e?"rgb(188,128,189)":"Autoref&#233;r&#233;nce"===e?"rgb(204,235,197)":"Po&#232;me de site"===e?"rgb(255,237,111)":"Myst&#232;re social"===e?"rgb(141,211,199)":"Pi&#232;ce sonore"===e?"rgb(255,255,179)":"Strat&#233;gie"===e?"rgb(190,186,218)":"Style"===e?"rgb(251,128,114)":"Sous-titre"===e?"rgb(128,177,211)":"Synesth&#233;sie"===e?"rgb(253,180,98)":"Activite d&#8217;absorption temporaire"===e?"rgb(179,222,105)":"Test"===e?"rgb(252,205,229)":"Th&#233;orie"===e?"rgb(217,217,217)":"&#192; faire sauter"===e?"rgb(188,128,189)":"&#192; faire sauter d&#8217;urgence"===e?"rgb(204,235,197)":"Pi&#232;ge"===e?"rgb(255,237,111)":"Zone de vrai"===e?"rgb(141,211,199)":"Geste votif"===e?"rgb(251,128,114)":"#FFEDA0"}function a(){f.eachLayer(function(e){var t=e.feature.properties,n=100,r="<i><b>"+t.SM+"</b></i> <br>"+t.Address+"<br>page "+t.Page;e.setRadius(n),e.bindPopup(r,{offset:new L.Point(0,10)}),e.options.color=o(t.SM),e.options.fillColor=o(t.SM)})}function c(e,t,n){var r=L.control({position:"bottomright"});r.onAdd=function(){var r=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(r,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(r).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){i(t,n,this.value),$(".temporal-legend").text("on Page "+this.value)}),r},r.addTo(M),d(e[0])}function s(t,r){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),M.setView([48.876,2.357],15),clearInterval(v),m=150,u(t,r,m),e(t.SMs,t,r),n()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),l(t,r,m)}),$(".step").click(function(){l(),$(".pause").hide(),$(".play").show(),p(t,r)}),$(".back").click(function(){l(),$(".pause").hide(),$(".play").show(),g(t,r)}),$(".back-full").click(function(){l(),$(".pause").hide(),$(".play").show(),h(t,r)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),b(t,r)}),$(".faster").click(function(){m>100?(m-=100,clearInterval(v),u(t,r,m)):m=150}),$(".slower").click(function(){1e3>m?(m+=100,clearInterval(v),u(t,r,m),console.log(m)):m=250})}function u(e,t,n){v=setInterval(function(){p(e,t)},n)}function l(e,t,n){n=0,clearInterval(v)}function g(e,t,n){k>9&&k--,i(e,t,k,n),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function p(e,t,n){238>k&&k++,i(e,t,k,n),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function b(e,t){k=238,i(e,t,k),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function h(e,t){k=9,i(e,t,k),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function d(e){var t=L.control({position:"bottomright"});t.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},t.addTo(M),$(".temporal-legend").text("on Page "+e)}var f,m,v,S=[],k=9;L.mapbox.accessToken="pk.eyJ1IjoiZGVhbm9sc2VuMSIsImEiOiJ1dkxBdm9FIn0.kapau_lUukKIE93Y8I0A9g";var M=L.mapbox.map("map","deanolsen1.l4i434a2",{zoomControl:!1,attributionControl:!1});M.setView([48.874,2.358],15),new L.Control.Zoom({position:"topright"}).addTo(M),$(window).resize(function(){$("#sliderContainer").css("margin-right","0px"),$("#temporal-legend").css("margin-right","0px"),SizeMe(M)}),SizeMe(M),$.getJSON("data/Locationsfrench.geojson").done(function(t){var o=r(t);i(o,t),c(o.pages,o,t),e(o.SMs,o,t),n(o,t),s(o,t)}).fail(function(){alert("There has been a problem loading the data.")}),$(".buttonMin").click(function(){$(this).toggleClass("btn-plus"),$("div.scroll").slideToggle()})});